---
/**
 * Landing page — serves custom HTML from _landing/index.html when present,
 * otherwise redirects to the first docs page.
 *
 * The custom landing page is a fully standalone HTML document (own <head>,
 * styles, scripts). It is rendered WITHOUT the docs Layout — no Header,
 * no Footer, no Sidebar.
 */
import fs from 'node:fs';
import path from 'node:path';
import { getConfigFile, getNavigation } from '../utils/config';

const config = await getConfigFile() as any;

// Check for custom landing page
const landingSource = config.landing?.source || '_landing';
const landingPath = path.join(process.cwd(), landingSource, 'index.html');

let landingHtml = '';
let hasCustomLanding = false;

try {
  if (fs.existsSync(landingPath)) {
    landingHtml = fs.readFileSync(landingPath, 'utf-8');
    hasCustomLanding = true;
  }
} catch {
  // Fall through to redirect
}

if (!hasCustomLanding) {
  const navigation = await getNavigation();
  let firstDocsPage = '/introduction';
  if (navigation?.sidebar?.length > 0) {
    const firstGroup = navigation.sidebar[0];
    if (firstGroup.items?.length > 0) {
      firstDocsPage = firstGroup.items[0].href || '/introduction';
    }
  }
  return Astro.redirect(firstDocsPage);
}
---
<Fragment set:html={landingHtml} />
